"use strict";angular.module("Newsme",["ionic","ui.keypress"]).service("ImageOrNo",function(){this.imageOrNo=function(a){return""!==a?a:"/images/no-image-availiable.jpg"}}).factory("SelectedDetailResult",function(){return{apiUrl:"",thumbnail:"",webTitle:"",trailText:"",byline:"",dialogOpen:!1,doCloseDialog:!1}}).run(["$rootScope","$ionicPlatform","$location","SelectedDetailResult",function(a,b){b.ready(function(){window.StatusBar&&StatusBar.styleDefault()})}]),angular.module("Newsme").controller("SearchController",["$scope","$http","SelectedDetailResult","$ionicModal","ImageOrNo",function(a,b,c,d,e){a.searchResults=[],a.selectedDetailResult=c,a.searchProperties={searchQuery:"",totalResults:0,currentPage:0,totalPages:0,inProgress:!1,errored:!1,searched:!1},d.fromTemplateUrl("templates/detail-modal.html",function(b){a.modal=b},{animation:"slide-in-up",focusFirstInput:!0}),a.fetchResults=function(){a.searchProperties.inProgress=!0,a.searchProperties.searched=!1,b.defaults.useXDomain=!0,b.jsonp("http://content.guardianapis.com/search?q="+a.searchProperties.searchQuery.replace(" ","+")+"&show-fields=thumbnail%2Cbyline%2CtrailText&callback=JSON_CALLBACK",{timeout:1e4}).success(function(b){a.searchResults=b.response.results,a.searchProperties.totalResults=b.response.total,a.searchProperties.currentPage=b.response.currentPage,a.searchProperties.totalPages=b.response.pages,a.searchProperties.inProgress=!1,a.searchProperties.errored=!1,a.searchProperties.searched=!0}).error(function(){a.searchProperties.errored=!0,a.searchProperties.inProgress=!1,a.searchResults=[]})},a.fetchMoreResults=function(){a.searchProperties.inProgress=!0,b.jsonp("http://content.guardianapis.com/search?q="+a.searchProperties.searchQuery.replace(" ","+")+"&page="+(a.searchProperties.currentPage+1)+"&show-fields=thumbnail%2Cbyline%2CtrailText&callback=JSON_CALLBACK").success(function(b){a.searchResults=a.searchResults.concat(b.response.results),a.searchProperties.totalResults=b.response.total,a.searchProperties.currentPage=b.response.currentPage,a.searchProperties.totalPages=b.response.pages,a.searchProperties.inProgress=!1,a.searchProperties.errored=!1}).error(function(){a.searchProperties.errored=!0,a.searchProperties.inProgress=!1})},a.showDetail=function(b){a.selectedDetailResult.apiUrl=b.apiUrl,a.selectedDetailResult.webTitle=b.webTitle,a.selectedDetailResult.thumbnail=b.fields.thumbnail,"undefined"==typeof a.selectedDetailResult.thumbnail&&(a.selectedDetailResult.thumbnail=""),a.selectedDetailResult.byline=b.fields.byline,"undefined"==typeof a.selectedDetailResult.byline&&(a.selectedDetailResult.byline=""),a.selectedDetailResult.trailText=b.fields.trailText,"undefined"==typeof a.selectedDetailResult.trailText&&(a.selectedDetailResult.trailText=""),a.selectedDetailResult.dialogOpen=!0,a.modal.show()},a.$watch("selectedDetailResult.doCloseDialog",function(){1==a.selectedDetailResult.doCloseDialog&&(modal.close(),a.selectedDetailResult.doCloseDialog=!1,a.selectedDetailResult.dialogOpen=!1)}),a.getThumbnail=function(a){return e.imageOrNo(a)}}]),angular.module("Newsme").controller("DetailController",["$scope","$http","SelectedDetailResult","ImageOrNo",function(a,b,c,d){a.selectedDetailResult=c,a.relatedResults=[],a.detailProperties={shortUrl:"",lastUpdated:"",inProgress:!1,errored:!1},a.fetchDetailed=function(){a.detailProperties.inProgress=!0,b.jsonp(a.selectedDetailResult.apiUrl+"?show-fields=thumbnail%2Cbyline%2CtrailText%2CshortUrl%2ClastModified&show-related=true&callback=JSON_CALLBACK",{timeout:1e4}).success(function(b){a.relatedResults=b.response.relatedContent.slice(0,5),a.detailProperties.shortUrl=b.response.content.fields.shortUrl,a.detailProperties.lastUpdated=b.response.content.fields.lastModified,a.detailProperties.inProgress=!1,a.detailProperties.errored=!1}).error(function(){a.detailProperties.errored=!0,a.detailProperties.inProgress=!1})},a.getThumbnail=function(a){return d.imageOrNo(a)},a.$watch("selectedDetailResult.apiUrl",function(){""!=a.selectedDetailResult.apiUrl&&a.fetchDetailed()})}]);